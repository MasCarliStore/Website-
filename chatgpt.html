<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ChatGPT - MasCarli Store</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<meta name="theme-color" content="#020617">
</head>
<body>
  <header>
  <div class="logo"><i class="fa fa-bolt"></i> MasCarli Store</div>
  <div class="hamburger" onclick="toggleMenu()"><i class="fa fa-bars"></i></div>
</header>
<nav id="nav">
 <a href="index.html"><i class="fa fa-home"></i> Beranda</a>
 <a href="produk.html"><i class="fa fa-box"></i> Produk</a>
 <a href="bantuan.html"><i class="fa fa-circle-question"></i> Bantuan</a>
</nav>



<div class="container">
  <div class="product-grid" id="list">
    
  </div>
</div>
<footer class="footer">
  <div class="footer-copy">
    Â© 2023â€“2025 MasCarli Store<br>
    <span class="footer-info">
      <i class="fas fa-envelope"></i>
      support@mascarli.biz.id
      <span class="divider">|</span>
      <i class="fab fa-whatsapp"></i>
      +62 831-2564-8754
    </span>
  </div>
</footer>

<script src="app.js"></script>
<script>
const FILTER_IDS = [5, 119, 120];      // ChatGPT
const productImages = {
  5: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQeoiSgZ5ncUiHnMl75G8KYje7U22y-1k5xb1I5u2MwDg&s=10",
  119: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQeoiSgZ5ncUiHnMl75G8KYje7U22y-1k5xb1I5u2MwDg&s=10",
  120: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQeoiSgZ5ncUiHnMl75G8KYje7U22y-1k5xb1I5u2MwDg&s=10",
};
fetch(BASE_URL + '/api/products', {
  method: 'POST',
  headers: { 'Content-Type':'application/json' },
  body: JSON.stringify({})
})
.then(r => r.json())
.then(d => {
  const list = document.getElementById('list');
  list.innerHTML = '';

  d.products
    .filter(p => FILTER_IDS.includes(Number(p.id)))
    .forEach(p => {

      const imgSrc = productImages[p.id] || 'default.png';

      list.innerHTML += `
        <div class="card" id="card-${p.id}">
          <img src="${imgSrc}" class="card-img">
          <h4 class="card-title">${p.name}</h4>
          <p class="card-price">Rp ${rupiah(p.price)}</p>
          <p class="card-stock" id="stock-${p.id}">Stok: ...</p>
          <a href="konfirmasi.html?id=${p.id}" 
             class="btn-beli" 
             id="btn-${p.id}">
             Beli
          </a>
        </div>
      `;

      // ðŸ”¥ AMBIL STOK REAL (SATU PER PRODUK)
      fetch(BASE_URL + '/api/stock', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ product_id: p.id })
      })
      .then(r => r.json())
      .then(s => {
        const stock = Number(s.stock || 0);
        const stockEl = document.getElementById(`stock-${p.id}`);
        const btn = document.getElementById(`btn-${p.id}`);

        stockEl.innerText = `Stok: ${stock}`;

        if(stock < 1){
          btn.innerText = 'Habis';
          btn.style.pointerEvents = 'none';
          btn.style.opacity = '0.5';
        }
      })
      .catch(() => {
        document.getElementById(`stock-${p.id}`).innerText = 'Stok: 0';
      });

    });
})
.catch(err => console.error('Error fetch produk:', err));

function rupiah(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
}
</script>

</body>
</html>